# –ü–æ–ª–∏—Ç–∏–∫–∞ –∫—ç—à–∏—Ä–æ–≤–∞–Ω–∏—è: –õ–∏–≥–∞ –û–±–Ω–∏–Ω—Å–∫–∞

## –°—Ö–µ–º–∞ –∫—ç—à-–∫–ª—é—á–µ–π

–í—Å–µ –∫—ç—à-–∫–ª—é—á–∏ —Å–ª–µ–¥—É—é—Ç –ø—Ä–∏–Ω—Ü–∏–ø—É `–∫–∞—Ç–µ–≥–æ—Ä–∏—è:—Ç–∏–ø[:–¥–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ_–ø–∞—Ä–∞–º–µ—Ç—Ä—ã]`

### 1. League (–õ–∏–≥–∞) ‚Äî TTL: 5-30 —Å–µ–∫
- `league:table` ‚Äî —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–≥–∏ (5 —Å–µ–∫, SWR=15 —Å–µ–∫)
- `league:schedule` ‚Äî —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ –º–∞—Ç—á–µ–π (8 —Å–µ–∫)
- `league:stats` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –ª–∏–≥–∏ (30 —Å–µ–∫)
- `league:results` ‚Äî —Ä–µ–∑—É–ª—å—Ç–∞—Ç—ã –º–∞—Ç—á–µ–π (15 —Å–µ–∫)
- `league:bracket` ‚Äî —Å–µ—Ç–∫–∞ –ø–ª–µ–π-–æ—Ñ—Ñ (10 —Å–µ–∫, SWR=30 —Å–µ–∫, ETag –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω –ø–æ—Å–ª–µ –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è stub-—Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ `/api/bracket`)

### 2. Match Details (–î–µ—Ç–∞–ª–∏ –º–∞—Ç—á–µ–π) ‚Äî TTL: 10 –º–∏–Ω/—Ä–µ–∞–ª—Ç–∞–π–º
- `md:{match_id}` ‚Äî –æ—Å–Ω–æ–≤–Ω—ã–µ –¥–µ—Ç–∞–ª–∏ –º–∞—Ç—á–∞ (10 –º–∏–Ω)
- `md:etag-temp:{match_id}` ‚Äî –≤—Ä–µ–º–µ–Ω–Ω—ã–µ ETag –∑–∞–ø–∏—Å–∏
- `md:stats:{match_id}` ‚Äî —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞ –º–∞—Ç—á–∞ (—Ä–µ–∞–ª—Ç–∞–π–º, SWR=5 —Å–µ–∫)
    - –ò–Ω–≤–∞–ª–∏–¥–∏—Ä—É–µ—Ç—Å—è —á–µ—Ä–µ–∑ `broadcastMatchStatistics`: –ª—é–±—ã–µ —Ä—É—á–Ω—ã–µ –ø—Ä–∞–≤–∫–∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ –∏–ª–∏ CRUD —Å–æ–±—ã—Ç–∏–π (–∂—ë–ª—Ç—ã–µ/–∫—Ä–∞—Å–Ω—ã–µ –∫–∞—Ä—Ç–æ—á–∫–∏)
        –ø–µ—Ä–µ—Å—á–∏—Ç—ã–≤–∞—é—Ç payload –∏ –ø—É–±–ª–∏–∫—É—é—Ç patch –Ω–∞ —Ç–æ–ø–∏–∫ `match:{match_id}:stats`.

### 3. Predictions (–ü—Ä–æ–≥–Ω–æ–∑—ã) ‚Äî TTL: 2-5 –º–∏–Ω
- `predictions:list` ‚Äî —Å–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö –ø—Ä–æ–≥–Ω–æ–∑–æ–≤ (5 –º–∏–Ω)
- `predictions:user:{user_id}` ‚Äî –ø—Ä–æ–≥–Ω–æ–∑—ã –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è (2 –º–∏–Ω)

### 4. Leaderboard (–õ–∏–¥–µ—Ä–±–æ—Ä–¥—ã) ‚Äî TTL: 1 –º–∏–Ω
- `lb:predictors` ‚Äî —Ç–æ–ø –ø—Ä–æ–≥–Ω–æ–∑–∏—Å—Ç–æ–≤ (1 –º–∏–Ω)
- `lb:rich` ‚Äî —Ç–æ–ø –±–æ–≥–∞—Ç—ã—Ö –∏–≥—Ä–æ–∫–æ–≤ (1 –º–∏–Ω) 
- `lb:server` ‚Äî —Å–µ—Ä–≤–µ—Ä–Ω—ã–µ –ª–∏–¥–µ—Ä—ã (1 –º–∏–Ω)
- `lb:prizes` ‚Äî –ø—Ä–∏–∑—ã –∏ –Ω–∞–≥—Ä–∞–¥—ã (30 —Å–µ–∫)

### 5. Achievements (–î–æ—Å—Ç–∏–∂–µ–Ω–∏—è) ‚Äî TTL: 30 –º–∏–Ω
- `achievements:v1` ‚Äî –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏–µ –¥–æ—Å—Ç–∏–∂–µ–Ω–∏—è (30 –º–∏–Ω)

### 6. Ads & Features (–†–µ–∫–ª–∞–º–∞/–§–∏—á–∏) ‚Äî TTL: 5-15 –º–∏–Ω
- `ads:topmatch` ‚Äî —Ç–æ–ø –º–∞—Ç—á –¥–ª—è —Ä–µ–∫–ª–∞–º—ã (15 –º–∏–Ω)

### 7. Database API ‚Äî TTL: varies
- `GET:{endpoint}` ‚Äî –æ–±—â–∏–π –ø–∞—Ç—Ç–µ—Ä–Ω

### 8. Admin Stats Cache (Fastify Multi-Level)
- `season:{seasonId}:club-stats` ‚Äî 3600 c (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Ç—á–∞, –ø–æ –∫–ª—é—á—É —Å–µ–∑–æ–Ω–∞)
- `season:{seasonId}:player-stats` ‚Äî 3600 c (–∞–Ω–∞–ª–æ–≥–∏—á–Ω–æ)
- `competition:{competitionId}:club-career` ‚Äî 7200 c (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Ç—á–∞)
- `competition:{competitionId}:player-career` ‚Äî 7200 c (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Ç—á–∞)
- `league:club-career` ‚Äî 7200 c (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Ç—á–∞)
- `league:player-career` ‚Äî 7200 c (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Ç—á–∞)
- `club:{clubId}:player-career` ‚Äî 7200 c (–∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è –ø—Ä–∏ —Ñ–∏–Ω–∞–ª–∏–∑–∞—Ü–∏–∏ –º–∞—Ç—á–∞)

–ö–∞–∂–¥—ã–π –æ—Ç–≤–µ—Ç –∞–¥–º–∏–Ω—Å–∫–∏—Ö —Å—Ç–∞—Ç–∏—Å—Ç–∏—á–µ—Å–∫–∏—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç `X-Resource-Version` –∏ `meta.version`, —á—Ç–æ–±—ã –∫–ª–∏–µ–Ω—Ç—ã –º–æ–≥–ª–∏ —Å—Ä–∞–≤–Ω–∏–≤–∞—Ç—å –≤–µ—Ä—Å–∏–∏ –±–µ–∑ –ø–æ–≤—Ç–æ—Ä–Ω–æ–π –≤—ã–±–æ—Ä–∫–∏ –ø—Ä–∏ –Ω–µ–∏–∑–º–µ–Ω–Ω–æ–º payload.

### 9. Public Aggregates (HTTP + WS)
- `public:league:table` ‚Äî 300 c (SWR 45 c, WS topic `league:table`)
- `public:league:top-scorers` ‚Äî 300 c (SWR 60 c, WS topic `league:scorers`)
- `public:league:form:{seasonId}` ‚Äî 600 c (SWR 120 c, WS topic `league:form`)
- `public:matches:live` ‚Äî 5 c (SWR 15 c, WS topic `matches:live`)
- `public:club:{clubId}:summary` ‚Äî 1200 c (SWR 300 c, WS topic `club:{clubId}:summary`)
- `public:predictions:leaderboard` ‚Äî 1200 c (SWR 300 c, WS topic `predictions:leaderboard`)

–í–µ—Ä—Å–∏—è —Ä–µ—Å—É—Ä—Å–∞ –ø–µ—Ä–µ–¥–∞—ë—Ç—Å—è —á–µ—Ä–µ–∑ `X-Resource-Version` –∏ `meta.version`, –æ–±–Ω–æ–≤–ª—è–µ—Ç—Å—è –≤–æ—Ä–∫–µ—Ä–æ–º `stats-aggregation` –ø–æ—Å–ª–µ –ø–µ—Ä–µ—Å—á—ë—Ç–æ–≤ `handleMatchFinalization`.

###	8.–ó–∞—â–∏—Ç–∞ –æ—Ç –∫—ç—à-–±–æ–º–±
-	–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ä–∞–∑–º–µ—Ä–∞ –∫—ç—à–∞ –Ω–∞ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
	MAX_CACHE_ENTRIES_PER_USER = 50
-	–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —á–∞—Å—Ç–æ—Ç—ã –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ –æ–¥–Ω–æ–º—É –∫–ª—é—á—É:
	RATE_LIMIT_PER_KEY = "10/–º–∏–Ω"
-	–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏ –ª–∏–º–∏—Ç–∞:
	LRU (Least Recently Used) —Å—Ç—Ä–∞—Ç–µ–≥–∏—è

## –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏

### Automatic (–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è)
- –ü–æ TTL —Å—Ä–æ–∫–∞ –¥–∞–≤–Ω–æ—Å—Ç–∏
- –ü—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ 304 Not Modified ‚Äî –ø—Ä–æ–¥–ª–µ–Ω–∏–µ –∫—ç—à–∞

### Event-driven (–ü–æ —Å–æ–±—ã—Ç–∏—è–º)
- WS —Å–æ–±—ã—Ç–∏—è `data_patch` ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏—Ö –∫–ª—é—á–µ–π
- `match_results_update` ‚Üí `league:table`, `league:stats`
- `match_stats_update` (–ø—É–±–ª–∏–∫—É–µ—Ç—Å—è `broadcastMatchStatistics`) ‚Üí `md:stats:{matchId}`
- `schedule_update` ‚Üí `league:schedule`
- `bracket_update` ‚Üí `league:bracket`
- `odds_update` ‚Üí `predictions:*`
- `match_finalized` (Fastify `handleMatchFinalization`) ‚Üí `season:{id}:club-stats`, `season:{id}:player-stats`, `competition:{id}:club-stats`, `competition:{id}:player-stats`, `competition:{id}:club-career`, `competition:{id}:player-career`, `league:club-career`, `league:player-career`, `club:{id}:player-career`

###	üîÅ –°—Ç—Ä–∞—Ç–µ–≥–∏–∏ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
-	Automatic
    –ü–æ –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL
    –ü—Ä–∏ 304 Not Modified ‚Äî –ø—Ä–æ–¥–ª–µ–Ω–∏–µ TTL
-	Event-driven (—á–µ—Ä–µ–∑ WebSocket)
    data_patch ‚Üí –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏—è —Å–≤—è–∑–∞–Ω–Ω—ã—Ö –∫–ª—é—á–µ–π
    match_results_update ‚Üí league:table, league:stats
    schedule_update ‚Üí league:schedule
    odds_update ‚Üí predictions:*

## TTL –ø–æ –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç—É –æ–±–Ω–æ–≤–ª–µ–Ω–∏–π

### –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏ –≤–∞–∂–Ω—ã–µ (—Ä–µ–∞–ª—Ç–∞–π–º) ‚Äî 5-30 —Å–µ–∫
- –°—á–µ—Ç –º–∞—Ç—á–µ–π, —Ç–∞–±–ª–∏—Ü–∞ –ª–∏–≥–∏, –∫–æ—ç—Ñ—Ñ–∏—Ü–∏–µ–Ω—Ç—ã
- –°–µ—Ç–∫–∞ –ø–ª–µ–π-–æ—Ñ—Ñ (–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è —Å—Ç–∞–¥–∏–π –∏ —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤)

### –í–∞–∂–Ω—ã–µ (—á–∞—Å—Ç—ã–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è) ‚Äî 1-5 –º–∏–Ω
- –ü—Ä–æ–≥–Ω–æ–∑—ã, –ª–∏–¥–µ—Ä–±–æ—Ä–¥—ã, —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞

### –°—Ç–∞–±–∏–ª—å–Ω—ã–µ (—Ä–µ–¥–∫–∏–µ –æ–±–Ω–æ–≤–ª–µ–Ω–∏—è) ‚Äî 10-30 –º–∏–Ω
- –î–æ—Å—Ç–∏–∂–µ–Ω–∏—è, –¥–µ—Ç–∞–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- Admin career stats (–∫–ª—É–±—ã/–∏–≥—Ä–æ–∫–∏) ‚Äî 3 –º–∏–Ω (TTL 180 c –±–µ–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤, rely on event-driven invalidation)

## –ü—Ä–∞–≤–∏–ª–∞ –≤–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### ETag-based
- –°–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç ETag –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
- –ö–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç `If-None-Match`
- 304 ‚Üí –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫—ç—à, –æ–±–Ω–æ–≤–∏—Ç—å TTL

### Version-based (–¥–ª—è WS –ø–∞—Ç—á–µ–π)
- ETag-based: –¥–ª—è HTTP-–∑–∞–ø—Ä–æ—Å–æ–≤
- Version-based: –¥–ª—è WS-–ø–∞—Ç—á–µ–π (version > current)
- MultiLevel Cache: –∫–∞–∂–¥—ã–π cache key —Å–æ–ø—Ä–æ–≤–æ–∂–¥–∞–µ—Ç—Å—è `X-Resource-Version` (—á–∏—Å–ª–æ–≤–æ–π –∏–Ω–∫—Ä–µ–º–µ–Ω—Ç), –≤—ã—á–∏—Å–ª—è–µ–º—ã–π –ø–æ SHA1-—Ñ–∏–Ω–≥–µ—Ä–ø—Ä–∏–Ω—Ç—É —Å–µ—Ä–∏–∞–ª–∏–∑–æ–≤–∞–Ω–Ω–æ–≥–æ payload. –ó–Ω–∞—á–µ–Ω–∏–µ –ø—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ –æ—Ç–≤–µ—Ç–∞ –∏ `meta.version` –≤ —Ç–µ–ª–µ.

## –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∫—ç—à–∞

### –ú–µ—Ç—Ä–∏–∫–∏ –≤ debug —Ä–µ–∂–∏–º–µ
- Cache hit/miss ratio –ø–æ –∫–∞—Ç–µ–≥–æ—Ä–∏—è–º
- –ß–∞—Å—Ç–æ—Ç–∞ –∏–Ω–≤–∞–ª–∏–¥–∞—Ü–∏–∏
- –†–∞–∑–º–µ—Ä –∫—ç—à–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö

## –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –ø–æ –æ–∫—Ä—É–∂–µ–Ω–∏—è–º

### Development
- –ö–æ—Ä–æ—Ç–∫–∏–µ TTL –¥–ª—è –±—ã—Å—Ç—Ä–æ–≥–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏—è
- –ü–æ–¥—Ä–æ–±–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∫—ç—à-–æ–ø–µ—Ä–∞—Ü–∏–π

### Production
- –û–ø—Ç–∏–º–∞–ª—å–Ω—ã–µ TTL –¥–ª—è –±–∞–ª–∞–Ω—Å–∞ –Ω–∞–≥—Ä—É–∑–∫–∏/—Å–≤–µ–∂–µ—Å—Ç–∏
- –û—à–∏–±–∫–∏ –∫—ç—à–∞ –Ω–µ –¥–æ–ª–∂–Ω—ã –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å UI
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–¥–º–∏–Ω-–ø–∞–Ω–µ–ª–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –ª–æ–∫–∞–ª—å–Ω—ã–π TTL (SWR) –±–µ–∑ —Ñ–æ–Ω–æ–≤—ã—Ö –≤–æ—Ä–∫–µ—Ä–æ–≤: –ø–æ–≤—Ç–æ—Ä–Ω—ã–µ –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ –≤–∫–ª–∞–¥–∫–∞—Ö ¬´–ö–æ–º–∞–Ω–¥—ã¬ª, ¬´–ú–∞—Ç—á–∏¬ª, ¬´–°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞¬ª —Ç—Ä–∏–≥–≥–µ—Ä—è—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–∏ —è–≤–Ω–æ–º –∏—Å—Ç–µ—á–µ–Ω–∏–∏ TTL –∏–ª–∏ —Å–º–µ–Ω–µ –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤ (—Å–µ–∑–æ–Ω/—Ç—É—Ä–Ω–∏—Ä)