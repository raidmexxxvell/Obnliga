# –ü—Ä–æ–µ–∫—Ç: Obnliga ‚Äî –§—É—Ç–±–æ–ª—å–Ω–∞—è –ª–∏–≥–∞ (–ö—Ä–∞—Ç–∫–æ–µ –æ–ø–∏—Å–∞–Ω–∏–µ)

–î–∞—Ç–∞: 2025-09-28

–ö—Ä–∞—Ç–∫–æ:
- –¶–µ–ª—å: MVP Telegram WebApp –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –º–∏–Ω–∏-–ª–∏–≥–æ–π —Å live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏—è–º–∏ –º–∞—Ç—á–µ–π, —Å—Ç–∞–≤–∫–∞–º–∏, –ø—Ä–æ—Ñ–∏–ª–µ–º –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏ –º–∞–≥–∞–∑–∏–Ω–æ–º.
- –°—Ç–µ–∫: Backend ‚Äî Node.js + TypeScript + Fastify + Prisma + Redis + BullMQ; Frontend ‚Äî Vite + React/Preact + TypeScript + single-store (fa√ßade –Ω–∞ Zustand/nano-stores).
- –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–∏–Ω—Ü–∏–ø—ã: multilevel cache (in-memory LRU + Redis), ETag + SWR, patch-based WebSocket (patch|full), audit/admin-logger.

–°–æ—Å—Ç–æ—è–Ω–∏–µ –Ω–∞ —Ç–µ–∫—É—â–∏–π –º–æ–º–µ–Ω—Ç:
- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω skeleton –ø—Ä–æ–µ–∫—Ç–∞ (backend/frontend/shared). (—Å–º. `docs/roadmap.md`).
- Prisma schema –∏ –∫–ª–∏–µ–Ω—Ç (dev sqlite / production Postgres) ‚Äî –≤ `prisma/schema.prisma`.
- –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω multilevel cache skeleton: `backend/src/cache/multilevelCache.ts`.
- –î–æ–±–∞–≤–ª–µ–Ω ETag-–ø–ª–∞–≥–∏–Ω Fastify: `backend/src/plugins/etag.ts` –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `server.ts` (—Å–º. `audit/changes/0005-add-etag-middleware.md`).
- –°–æ–∑–¥–∞–Ω –æ—Ç–¥–µ–ª—å–Ω—ã–π —Ñ—Ä–æ–Ω—Ç–µ–Ω–¥ –¥–ª—è –∞–¥–º–∏–Ω-–¥—ç—à–±–æ—Ä–¥–∞ (`admin/`), –≤–∫–ª—é—á–∞—é—â–∏–π –≤—Ö–æ–¥ –ø–æ ENV-–ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º Render –∏ –≤–∫–ª–∞–¥–æ—á–Ω—É—é —Å—Ç—Ä—É–∫—Ç—É—Ä—É (–ö–æ–º–∞–Ω–¥—ã, –ú–∞—Ç—á–∏, –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞, –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∏–≥—Ä–æ–∫–∞–º–∏, –ù–æ–≤–æ—Å—Ç–∏) ‚Äî –ø–æ–∫–∞ —Å–æ–¥–µ—Ä–∂–∞—Ç—Å—è –∑–∞–≥–ª—É—à–∫–∏.

- Backend —Ä–∞—Å—à–∏—Ä–µ–Ω —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–º `/api/admin/login`, –∏—Å–ø–æ–ª—å–∑—É—é—â–∏–º –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è `LOGIN_ADMIN` –∏ `PASSWORD_ADMIN` –¥–ª—è –≤—ã–¥–∞—á–∏ JWT —Ç–æ–∫–µ–Ω–∞ –∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–æ—Ä—É. –ú–∞—Ä—à—Ä—É—Ç –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω –≤ `backend/src/server.ts`.

- –î–æ–±–∞–≤–ª–µ–Ω–∞ –º–æ–¥–µ–ª—å `User` –∏ –±–∞–∑–æ–≤—ã–π flow –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏ —á–µ—Ä–µ–∑ Telegram WebApp (server-side `initData` verification, JWT issuance). –§–∞–π–ª—ã: `backend/src/routes/authRoutes.ts`, `backend/src/routes/userRoutes.ts`, `frontend/src/Profile.tsx`.
- –î–æ–±–∞–≤–ª–µ–Ω–∞ prototype —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è realtime: Fastify WebSocket endpoint + Redis pub/sub glue (`backend/src/realtime/index.ts`) –∏ –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∫–ª–∏–µ–Ω—Ç `frontend/src/wsClient.ts`. –î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π –æ—Ç–ª–∞–¥–∫–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º Redis (—Å–º. `docs/prisma.md` –∏ `docs/dev-setup.md`).

–ü—Ä–æ–≤–µ—Ä–∫–∞ –ø—Ä–∞–≤–∏–ª ‚Äî –û–ö
1) –ü—Ä–æ—á–∏—Ç–∞–Ω—ã `docs/roadmap.md`, `audit/mcp-context7-summary.md` –∏ `docs/dev-setup.md`.
2) MCP context7: `audit/mcp-context7-summary.md` –ø—Ä–∏—Å—É—Ç—Å—Ç–≤—É–µ—Ç –∏ —Å–æ–¥–µ—Ä–∂–∏—Ç –Ω–∞–±–æ—Ä –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤/—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–π.
3) –ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã –ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω—ã –Ω–∏–∂–µ –∏ –æ—Ü–µ–Ω–µ–Ω–æ –≤–ª–∏—è–Ω–∏–µ –Ω–∞ —Å–µ—Ç—å/–∫—ç—à/WS.
4) –ó–∞–¥–∞—á–∞ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç —Å—Ç–∞—Ç—É—Å—É roadmap (Phase 2 ‚Äî ETag / Phase 3 ‚Äî cache).
5) –ò–∑–º–µ–Ω–µ–Ω–∏—è –∞–∫–∫—É—Ä–∞—Ç–Ω—ã–µ, –∞—Ç–æ–º–∞—Ä–Ω—ã–µ –∏ –∑–∞—Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω—ã –≤ `audit/changes/0005-add-etag-middleware.md`.

–ó–∞—Ç—Ä–æ–Ω—É—Ç—ã–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã
- Backend
  - `src/server.ts` ‚Äî bootstrap, —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è –ø–ª–∞–≥–∏–Ω–æ–≤
  - `src/plugins/etag.ts` ‚Äî –Ω–æ–≤—ã–π ETag middleware
  - `src/cache/*` ‚Äî multilevel cache
  - `routes/*` ‚Äî demo API (–Ω–∞–ø—Ä–∏–º–µ—Ä `/api/cache/:key`)
- Frontend
  - `src/api/etag.ts` ‚Äî fetch wrapper (–ø–ª–∞–Ω)
  - `src/store/*` ‚Äî store fa√ßade (matchesStore, userStore, shopStore, realtimeStore)

–í–ª–∏—è–Ω–∏–µ –∏–∑–º–µ–Ω–µ–Ω–∏–π –Ω–∞ —Å–µ—Ç—å / –∫—ç—à / WS
- ETag middleware —Ä–∞–±–æ—Ç–∞–µ—Ç: –∫–ª–∏–µ–Ω—Ç –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç If-None-Match, —Å–µ—Ä–≤–µ—Ä –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç 304 –ø—Ä–∏ —Å–æ–≤–ø–∞–¥–µ–Ω–∏–∏, —ç–∫–æ–Ω–æ–º–∏—Ç —Ç—Ä–∞—Ñ–∏–∫ ‚úÖ
- Multilevel cache —Å–Ω–∏–∂–∞–µ—Ç latency: backend –∫—ç—à–∏—Ä—É–µ—Ç –ø—Ä–æ—Ñ–∏–ª–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π (TTL 5 –º–∏–Ω), frontend –∏—Å–ø–æ–ª—å–∑—É–µ—Ç localStorage + ETag ‚úÖ  
- Cache invalidation —á–µ—Ä–µ–∑ Redis pub/sub –æ–±–µ—Å–ø–µ—á–∏–≤–∞–µ—Ç —Å–æ–≥–ª–∞—Å–æ–≤–∞–Ω–Ω–æ—Å—Ç—å –ø—Ä–∏ –æ–±–Ω–æ–≤–ª–µ–Ω–∏–∏ –ø—Ä–æ—Ñ–∏–ª–µ–π ‚úÖ
- Patch-based WS –≥–æ—Ç–æ–≤ –∫ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ ‚Äî patch|full –ø—Ä–æ—Ç–æ–∫–æ–ª –¥–ª—è live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –ø—Ä–æ—Ñ–∏–ª–µ–π –∏ —Å—Ç–∞—Ç–∏—Å—Ç–∏–∫–∏ ‚è≥

–í–ª–∏—è–Ω–∏–µ –Ω–∞ –º–µ—Ç—Ä–∏–∫–∏ (–æ—Ü–µ–Ω–∫–∞)
- Retention: üîµ ‚Äî —É–ª—É—á—à–µ–Ω–∏–µ –∑–∞ —Å—á—ë—Ç –±–æ–ª–µ–µ –ø–ª–∞–≤–Ω—ã—Ö live-–æ–±–Ω–æ–≤–ª–µ–Ω–∏–π –∏ –±—ã—Å—Ç—Ä—ã—Ö –æ—Ç–∫–ª–∏–∫–æ–≤.
- Engagement: üîµ ‚Äî WebApp —Å real-time –∏ shop/—Å—Ç–∞–≤–∫–∞–º–∏ –ø–æ–≤—ã—à–∞–µ—Ç –≤–æ–≤–ª–µ—á—ë–Ω–Ω–æ—Å—Ç—å.
- Revenue: ‚ö™ ‚Äî –ø–æ–∫–∞ –Ω–µ –∫—Ä–∏—Ç–∏—á–Ω–æ, –Ω–æ shop/–±–µ—Ç—Ç–∏–Ω–≥ –¥–æ–ø—É—Å–∫–∞—é—Ç –º–æ–Ω–µ—Ç–∏–∑–∞—Ü–∏—é.
- Tech Stability: üî¥ ‚Äî –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ ETag –∏ cache –ø–æ–≤—ã—à–∞–µ—Ç —É—Å—Ç–æ–π—á–∏–≤–æ—Å—Ç—å, –Ω–æ —Ç—Ä–µ–±—É–µ—Ç —Ç–µ—Å—Ç–æ–≤ –Ω–∞ inconsistency.

–ö–∞–∫ –∑–∞–ø—É—Å–∫–∞—Ç—å (–ª–æ–∫–∞–ª—å–Ω–æ)
1. Backend
   - –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –∏ –∑–∞–ø—É—Å—Ç–∏—Ç—å dev —Å–µ—Ä–≤–µ—Ä:
     npm install
     cd backend
     npm install
     npm run dev
   - –ü—Ä–æ–≤–µ—Ä–∏—Ç—å /health –∏ demo endpoints: `GET /api/cache/:key`.
  - –ó–∞–ø—É—Å–∫ Redis –ª–æ–∫–∞–ª—å–Ω–æ (—Ä–µ–∫–æ–º–µ–Ω–¥—É–µ—Ç—Å—è –¥–ª—è realtime):

```powershell
docker run -d --name obnliga-redis -p 6379:6379 redis:7-alpine
```
2. Frontend
   - cd frontend
   - npm install
   - npm run dev

–î–æ–∫—É–º–µ–Ω—Ç—ã –∏ —Å–ª–µ–¥—É—é—â–µ–µ –¥–µ–π—Å—Ç–≤–∏–µ
- –û–±–Ω–æ–≤–ª—è—Ç—å `docs/state.md` –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ —Å—Ç—Ä—É–∫—Ç—É—Ä—ã —Å—Ç–æ—Ä–∞.
- –°–ª–µ–¥—É—é—â–∏–π –ø—Ä–∏–æ—Ä–∏—Ç–µ—Ç: –¥–æ–±–∞–≤–∏—Ç—å unit/integration —Ç–µ—Å—Ç—ã –¥–ª—è ETag –∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è `frontend/src/api/etag.ts`.
