description: Выполнение некритичного анализа согласованности и качества между артефактами spec.md, plan.md и tasks.md после генерации задач.
Пользовательский ввод может быть предоставлен напрямую агентом или как аргумент команды - вы ОБЯЗАНЫ учесть его перед продолжением (если не пустой).
Пользовательский ввод:
$ARGUMENTS
Цель: Выявить несогласованности, дубликаты, неоднозначности и недостаточно определенные элементы между тремя основными артефактами (`spec.md`, `plan.md`, `tasks.md`) перед реализацией. Эта команда ДОЛЖНА запускаться только после успешного завершения `/tasks`, который создал полный `tasks.md`.
СТРОГО ТОЛЬКО ДЛЯ ЧТЕНИЯ: Не изменяйте никакие файлы. Выведите структурированный отчет об анализе. Предложите необязательный план исправлений (пользователь должен явно подтвердить перед любыми последующими редактированиями).

Полномочия устава: Проектный устав (`.specify/memory/constitution.md`) является безусловным в рамках этого анализа. Конфликты с уставом автоматически считаются КРИТИЧЕСКИМИ и требуют корректировки спецификации, плана или задач — без ослабления, переосмысления или игнорирования принципа. Если сам принцип требует изменения, это должно происходить в отдельном, явном обновлении устава вне команды `/analyze`.

Этапы выполнения:
1. Запустите `.specify/scripts/powershell/check-prerequisites.ps1 -Json -RequireTasks -IncludeTasks` один раз из корня репозитория и обработайте JSON для FEATURE_DIR и AVAILABLE_DOCS. Определите абсолютные пути:
   SPEC = FEATURE_DIR/spec.md
   PLAN = FEATURE_DIR/plan.md
   TASKS = FEATURE_DIR/tasks.md
   Прервите выполнение с сообщением об ошибке, если отсутствует любой требуемый файл (сообщите пользователю запустить необходимую команду).

2. Загрузите артефакты:
   - Обработайте разделы spec.md: Обзор/Контекст, Функциональные требования, Нефункциональные требования, Пользовательские истории, Краевые случаи (если присутствуют).
   - Обработайте plan.md: Архитектурные решения/стек, Ссылки на модель данных, Фазы, Технические ограничения.
   - Обработайте tasks.md: ID задач, описания, группировка по фазам, маркеры параллельного выполнения [P], ссылки на файлы.

3. Загрузите устав `.specify/memory/constitution.md` для проверки принципов.

4. Создайте внутренние семантические модели:
   - Инвентаризация требований: Каждое функциональное и нефункциональное требование с устойчивым ключом (создайте слаг на основе императивной фразы; например, "Пользователь может загружать файл" -> `user-can-upload-file`).
   - Инвентаризация пользовательских историй/действий.
   - Карта покрытия задач: Сопоставьте каждую задачу с одним или несколькими требованиями или историями (по ключевым словам или явным ссылкам).
   - Набор правил устава: Извлеките названия принципов и нормативные утверждения MUST/SHOULD.

5. Проверки на выявление проблем:
   A. Обнаружение дубликатов:
      - Выявите почти идентичные требования. Отметьте менее качественные формулировки для объединения.
   
   B. Обнаружение неоднозначностей:
      - Отметьте расплывчатые прилагательные (быстрый, масштабируемый, безопасный, интуитивный, надежный), не имеющие измеримых критериев.
      - Отметьте нерешенные заполнители (TODO, TKTK, ??? и т.д.).
   
   C. Недостаточная спецификация:
      - Требования с глаголами, но без объекта или измеримого результата.
      - Пользовательские истории без привязки к критериям принятия.
      - Задачи, ссылающиеся на файлы или компоненты, не определенные в спецификации/плане.
   
   D. Соответствие уставу:
      - Любые требования или элементы плана, конфликтующие с принципом MUST.
      - Отсутствующие обязательные разделы или контрольные точки из устава.
   
   E. Пробелы в покрытии:
      - Требования без связанных задач.
      - Задачи без сопоставления с требованием/историей.
      - Нефункциональные требования, не отраженные в задачах.
   
   F. Несогласованность:
      - Дрейф терминологии (одно и то же понятие названо по-разному в разных файлах).
      - Сущности данных, упомянутые в плане, но отсутствующие в спецификации (и наоборот).
      - Противоречия в порядке задач (например, интеграционные задачи до базовой настройки без указания зависимости).
      - Конфликтующие требования (например, одно требует использовать Next.js, другое говорит использовать Vue).

6. Присвоение уровня серьезности:
   - КРИТИЧЕСКИЙ: Нарушает принцип MUST устава, отсутствует основной артефакт спецификации, или требование без покрытия, блокирующее базовую функциональность.
   - ВЫСОКИЙ: Дублирующееся или конфликтующее требование, неоднозначное описание атрибута, некорректный критерий принятия.
   - СРЕДНИЙ: Дрейф терминологии, отсутствие покрытия нефункциональных требований, недостаточно определенный краевой случай.
   - НИЗКИЙ: Стиль/редактирование текста, незначительная избыточность, не влияющая на порядок выполнения.

7. Создайте отчет в формате Markdown (без записи в файлы) с разделами:
   ##	Отчет об анализе спецификации
   | ID | Категория | Серьезность | Расположение | Краткое описание | Рекомендация |
   | --- | --- | --- | --- | --- | --- |
   | A1 | Дублирование | ВЫСОКИЙ | spec.md:L120-134 | Два похожих требования... | Объедините формулировки; оставьте более четкую версию |
   (Добавьте одну строку на каждое обнаруженное несоответствие; создайте устойчивые ID с префиксом начальной буквы категории.)

   Дополнительные подразделы:
   - Сводная таблица покрытия:
     | Ключ требования | Есть задача? | ID задач | Примечания |
   - Проблемы соответствия уставу (при наличии)
   - Несопоставленные задачи (при наличии)

   Метрики:
   - Всего требований
   - Всего задач
   - Процент покрытия (требования с >=1 задачей)
   - Количество неоднозначностей
   - Количество дубликатов
   - Количество критических проблем

8. В конце отчета выведите краткий блок "Следующие действия":
   - Если есть КРИТИЧЕСКИЕ проблемы: Рекомендуйте устранить перед `/implement`.
   - Если только НИЗКИЕ/СРЕДНИЕ: Пользователь может продолжить, но предоставьте предложения по улучшению.
   - Укажите конкретные команды: например, "Запустите /specify с уточнением", "Запустите /plan для корректировки архитектуры", "Вручную отредактируйте tasks.md для добавления покрытия 'performance-metrics'".
   - Спросите пользователя: "Хотите, чтобы я предложил конкретные правки для топ N проблем?" (НЕ применяйте их автоматически.)

Правила поведения:
- НИКОГДА не изменяйте файлы.
- НИКОГДА не выдумывайте отсутствующие разделы — если отсутствуют, сообщите об этом.
- СОХРАНЯЙТЕ результаты детерминированными: при повторном запуске без изменений должны получаться одинаковые ID и подсчеты.
- ОГРАНИЧЬТЕ общее количество выявленных проблем в основной таблице до 50; остальные объедините в сводную заметку.
- Если проблем не найдено, выведите отчет об успехе со статистикой покрытия и рекомендацией по продолжению.

Контекст: $ARGUMENTS