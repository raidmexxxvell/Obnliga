# –ò–∑–º–µ–Ω–µ–Ω–∏–µ 0008: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –ø—Ä–æ—Ñ–∏–ª—è –∏ –∑–∞—Å—Ç–∞–≤–∫–∏ (–æ–±–Ω–æ–≤–ª–µ–Ω–æ –¥–ª—è Render.com)

**–î–∞—Ç–∞**: 1 –æ–∫—Ç—è–±—Ä—è 2025  
**–ê–≤—Ç–æ—Ä**: GitHub Copilot

## –ü—Ä–æ–±–ª–µ–º—ã

1. –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è "–ì–æ—Å—Ç—å" –≤–º–µ—Å—Ç–æ –∏–º–µ–Ω–∏ –∏ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è –∏–∑ Telegram
2. –ó–∞—Å—Ç–∞–≤–∫–∞ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –≤–Ω—É—Ç—Ä–∏ –±–ª–æ–∫–∞ —Å –∑–∞–¥–Ω–∏–º —Ñ–æ–Ω–æ–º, –∞ –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –ø—Ä–æ—Å—Ç–æ –ª–æ–≥–æ—Ç–∏–ø –Ω–∞ —Ñ–æ–Ω–µ
3. Frontend –Ω–∞ Render.com –Ω–µ –∑–Ω–∞–µ—Ç URL backend —Å–µ—Ä–≤–µ—Ä–∞

## –†–µ—à–µ–Ω–∏–µ

### 1. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≥—Ä—É–∑–∫–∏ –ø—Ä–æ—Ñ–∏–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è

**–§–∞–π–ª**: `frontend/src/Profile.tsx`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- –ü–µ—Ä–µ—Ä–∞–±–æ—Ç–∞–Ω–∞ –ª–æ–≥–∏–∫–∞ `loadProfile()`:
  - –¢–µ–ø–µ—Ä—å —Å–Ω–∞—á–∞–ª–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è –Ω–∞–ª–∏—á–∏–µ Telegram WebApp –∏ –¥–∞–Ω–Ω—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
  - –î–∞–Ω–Ω—ã–µ –∏–∑ `initDataUnsafe.user` –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ backend –¥–ª—è –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
  - –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏
  - –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ `initData`
  - –î–æ–±–∞–≤–ª–µ–Ω fallback –Ω–∞ token-based –∑–∞–≥—Ä—É–∑–∫—É
  
- –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è:
  - –£–±—Ä–∞–Ω —Å–∏–º–≤–æ–ª `@` –ø–µ—Ä–µ–¥ –∏–º–µ–Ω–µ–º
  - –¢–µ–ø–µ—Ä—å –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è `tgUsername` –Ω–∞–ø—Ä—è–º—É—é (–∫–æ—Ç–æ—Ä—ã–π —Å–æ–¥–µ—Ä–∂–∏—Ç `username` –∏–ª–∏ `first_name` —Å –±—ç–∫–µ–Ω–¥–∞)

#### –õ–æ–≥–∏–∫–∞ —Ä–∞–±–æ—Ç—ã:
1. –ü—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç—Å—è `window.Telegram.WebApp.initDataUnsafe.user`
2. –ï—Å–ª–∏ –¥–∞–Ω–Ω—ã–µ –µ—Å—Ç—å, –æ–Ω–∏ –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è –Ω–∞ `/api/auth/telegram-init`
3. Backend –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –∏ —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç JWT —Ç–æ–∫–µ–Ω
4. –¢–æ–∫–µ–Ω —Å–æ—Ö—Ä–∞–Ω—è–µ—Ç—Å—è –≤ `localStorage`
5. –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑ `/api/auth/me`

### 2. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ backend –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–≥–æ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è –∏–º–µ–Ω–∏

**–§–∞–π–ª**: `backend/src/routes/authRoutes.ts`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- –£–ª—É—á—à–µ–Ω–∞ –ª–æ–≥–∏–∫–∞ –∏–∑–≤–ª–µ—á–µ–Ω–∏—è `username`:
  ```typescript
  let username = params.username || params.first_name
  ```
  –¢–µ–ø–µ—Ä—å –µ—Å–ª–∏ `username` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç, –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è `first_name`
  
- –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –∏–∑–≤–ª–µ—á–µ–Ω–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö:
  ```typescript
  server.log.info({ userId, username, photoUrl }, 'Extracted user data from initData')
  ```

- –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ JSON-–æ–±—ä–µ–∫—Ç–∞ `user`:
  ```typescript
  username = username || uobj.username || uobj.first_name
  ```

### 3. –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞—Å—Ç–∞–≤–∫–∏ - —É–±—Ä–∞–Ω –±–ª–æ–∫ —Å —Ñ–æ–Ω–æ–º

**–§–∞–π–ª**: `frontend/src/app.css`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- –£–±—Ä–∞–Ω —Ñ–æ–Ω –∏–∑ –±–∞–∑–æ–≤–æ–≥–æ `.app-root`, –ø–µ—Ä–µ–Ω–µ—Å–µ–Ω —Ç–æ–ª—å–∫–æ –≤ `.app-root.main`
- –î–ª—è `.splash` –¥–æ–±–∞–≤–ª–µ–Ω—ã —Å—Ç–∏–ª–∏ –ø–æ–ª–Ω–æ—ç–∫—Ä–∞–Ω–Ω–æ–≥–æ –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏—è:
  ```css
  .splash {
    width: 100vw;
    height: 100vh;
    position: fixed;
    top: 0;
    left: 0;
    background: /* –≥—Ä–∞–¥–∏–µ–Ω—Ç—ã */;
    z-index: 9999;
  }
  ```

- **–£–±—Ä–∞–Ω –±–ª–æ–∫ `.splash-inner`** - —É–¥–∞–ª–µ–Ω—ã `backdrop-filter`, `border-radius`, `box-shadow` –∏ `background`:
  ```css
  .splash-inner {
    text-align: center;
    padding: 28px;
    /* –£–±—Ä–∞–Ω—ã: backdrop-filter, border-radius, box-shadow, background */
  }
  ```
  
  –¢–µ–ø–µ—Ä—å –ª–æ–≥–æ—Ç–∏–ø –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –ø—Ä—è–º–æ –Ω–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–º —Ñ–æ–Ω–µ –±–µ–∑ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞!

### 4. –ù–∞—Å—Ç—Ä–æ–π–∫–∞ CORS –Ω–∞ backend

**–§–∞–π–ª**: `backend/src/server.ts`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –ø–∞–∫–µ—Ç `@fastify/cors`
- –î–æ–±–∞–≤–ª–µ–Ω–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è CORS middleware:
  ```typescript
  import cors from '@fastify/cors'
  
  server.register(cors, {
    origin: true,  // Allow all origins in development
    credentials: true
  })
  ```

–≠—Ç–æ –ø–æ–∑–≤–æ–ª—è–µ—Ç frontend (–Ω–∞ –¥—Ä—É–≥–æ–º –¥–æ–º–µ–Ω–µ Render) –¥–µ–ª–∞—Ç—å –∑–∞–ø—Ä–æ—Å—ã –∫ backend API.

### 5. –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Render.com

**–§–∞–π–ª**: `render.yaml`

#### –ò–∑–º–µ–Ω–µ–Ω–∏—è:
- –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø–µ—Ä–µ–º–µ–Ω–Ω–∞—è –æ–∫—Ä—É–∂–µ–Ω–∏—è –¥–ª—è frontend:
  ```yaml
  - type: web
    name: futbol-league-frontend
    envVars:
      - key: VITE_BACKEND_URL
        value: "https://futbol-league-backend.onrender.com"
  ```

–¢–µ–ø–µ—Ä—å frontend –∑–Ω–∞–µ—Ç, –∫—É–¥–∞ –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å API –∑–∞–ø—Ä–æ—Å—ã –Ω–∞ Render.

## –¢–µ—Ö–Ω–∏—á–µ—Å–∫–∏–µ –¥–µ—Ç–∞–ª–∏

### –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –¥–∞–Ω–Ω—ã—Ö Telegram

–°–æ–≥–ª–∞—Å–Ω–æ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ –≤ `docs/profile.md`, Telegram WebApp –ø—Ä–µ–¥–æ—Å—Ç–∞–≤–ª—è–µ—Ç –¥–∞–Ω–Ω—ã–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è —á–µ—Ä–µ–∑:
- `window.Telegram.WebApp.initData` - –ø–æ–¥–ø–∏—Å–∞–Ω–Ω–∞—è —Å—Ç—Ä–æ–∫–∞ (–¥–ª—è HMAC –ø—Ä–æ–≤–µ—Ä–∫–∏)
- `window.Telegram.WebApp.initDataUnsafe` - –Ω–µ–±–µ–∑–æ–ø–∞—Å–Ω—ã–π –æ–±—ä–µ–∫—Ç —Å –¥–∞–Ω–Ω—ã–º–∏

–î–∞–Ω–Ω—ã–µ –≤–∫–ª—é—á–∞—é—Ç:
- `id` - Telegram user ID
- `first_name` - –∏–º—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
- `last_name` - —Ñ–∞–º–∏–ª–∏—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `username` - username (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `photo_url` - URL —Ñ–æ—Ç–æ –ø—Ä–æ—Ñ–∏–ª—è (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)
- `language_code` - –∫–æ–¥ —è–∑—ã–∫–∞

### –°—Ö–µ–º–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö

–¢–∞–±–ª–∏—Ü–∞ `users`:
```prisma
model User {
  id        Int      @id @default(autoincrement())
  userId    BigInt   @unique @map("user_id")  // Telegram ID
  tgUsername String? @map("tg_username")      // username –∏–ª–∏ first_name
  photoUrl  String?  @map("photo_url")        // URL —Ñ–æ—Ç–æ
  createdAt DateTime @map("created_at") @default(now())
  updatedAt DateTime @map("updated_at") @updatedAt
}
```

## –†–µ–∑—É–ª—å—Ç–∞—Ç

1. ‚úÖ –ü—Ä–∏ –≤—Ö–æ–¥–µ –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram WebApp —Ç–µ–ø–µ—Ä—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –∏–º—è –∏ —Ñ–æ—Ç–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è
2. ‚úÖ –ó–∞—Å—Ç–∞–≤–∫–∞ –∑–∞–Ω–∏–º–∞–µ—Ç –≤–µ—Å—å —ç–∫—Ä–∞–Ω, –ª–æ–≥–æ—Ç–∏–ø –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –±–µ–∑ –∫–≤–∞–¥—Ä–∞—Ç–Ω–æ–≥–æ –±–ª–æ–∫–∞ –Ω–∞ —á–∏—Å—Ç–æ–º –≥—Ä–∞–¥–∏–µ–Ω—Ç–Ω–æ–º —Ñ–æ–Ω–µ
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω–æ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–ª—è –æ—Ç–ª–∞–¥–∫–∏ –ø—Ä–æ—Ü–µ—Å—Å–∞ –∞—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏–∏
4. ‚úÖ –£–ª—É—á—à–µ–Ω–∞ –æ–±—Ä–∞–±–æ—Ç–∫–∞ —Ä–∞–∑–ª–∏—á–Ω—ã—Ö —Ñ–æ—Ä–º–∞—Ç–æ–≤ –¥–∞–Ω–Ω—ã—Ö –æ—Ç Telegram
5. ‚úÖ –ù–∞—Å—Ç—Ä–æ–µ–Ω CORS –¥–ª—è —Ä–∞–±–æ—Ç—ã frontend –∏ backend –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –¥–æ–º–µ–Ω–∞—Ö Render
6. ‚úÖ Frontend –∑–Ω–∞–µ—Ç URL backend —á–µ—Ä–µ–∑ `VITE_BACKEND_URL`

## –î–µ–ø–ª–æ–π –Ω–∞ Render.com

### –®–∞–≥–∏ –¥–ª—è –¥–µ–ø–ª–æ—è:

1. **–ó–∞–∫–æ–º–º–∏—Ç—å—Ç–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è:**
   ```bash
   git add .
   git commit -m "fix: —É–±—Ä–∞–Ω –±–ª–æ–∫ –∑–∞—Å—Ç–∞–≤–∫–∏, –Ω–∞—Å—Ç—Ä–æ–µ–Ω CORS –∏ VITE_BACKEND_URL –¥–ª—è Render"
   git push origin main
   ```

2. **Render –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–¥–µ–ø–ª–æ–∏—Ç –∏–∑–º–µ–Ω–µ–Ω–∏—è** (–Ω–∞—Å—Ç—Ä–æ–µ–Ω–æ `autoDeployTrigger: commit`)

3. **–ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è –≤ Render Dashboard:**
   - Backend –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å: `TELEGRAM_BOT_TOKEN`, `DATABASE_URL`, `REDIS_URL`
   - Frontend –¥–æ–ª–∂–µ–Ω –∏–º–µ—Ç—å: `VITE_BACKEND_URL=https://futbol-league-backend.onrender.com`

4. **–ü–æ—Å–ª–µ –¥–µ–ø–ª–æ—è –æ—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram** –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`

### –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–±–æ—Ç—ã:

1. –û—Ç–∫—Ä–æ–π—Ç–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram WebApp (–±–æ—Ç `@footballobn_bot`)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∑–∞—Å—Ç–∞–≤–∫—É - –¥–æ–ª–∂–Ω–∞ –±—ã—Ç—å –±–µ–∑ –±–ª–æ–∫–∞, —Ç–æ–ª—å–∫–æ –ª–æ–≥–æ—Ç–∏–ø –Ω–∞ –≥—Ä–∞–¥–∏–µ–Ω—Ç–µ
3. –ü–æ—Å–ª–µ –∑–∞–≥—Ä—É–∑–∫–∏ –æ—Ç–∫—Ä–æ–π—Ç–µ –≤–∫–ª–∞–¥–∫—É "–ü—Ä–æ—Ñ–∏–ª—å" (üë§)
4. –î–æ–ª–∂–Ω—ã –æ—Ç–æ–±—Ä–∞–∂–∞—Ç—å—Å—è:
   - –í–∞—à–µ —Ñ–æ—Ç–æ –∏–∑ Telegram (–µ—Å–ª–∏ –µ—Å—Ç—å)
   - –í–∞—à–µ –∏–º—è –∏–ª–∏ username
   - –î–∞—Ç–∞ —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏

## –û—Ç–ª–∞–¥–∫–∞ (–µ—Å–ª–∏ –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç)

### –ï—Å–ª–∏ –ø—Ä–æ—Ñ–∏–ª—å –ø–æ–∫–∞–∑—ã–≤–∞–µ—Ç "–ì–æ—Å—Ç—å":

1. –û—Ç–∫—Ä–æ–π—Ç–µ DevTools –≤ Telegram (–µ—Å–ª–∏ –¥–æ—Å—Ç—É–ø–Ω–æ)
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –∫–æ–Ω—Å–æ–ª—å –Ω–∞ –æ—à–∏–±–∫–∏
3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ Network tab - –¥–æ–ª–∂–µ–Ω –±—ã—Ç—å –∑–∞–ø—Ä–æ—Å –∫ `https://futbol-league-backend.onrender.com/api/auth/telegram-init`
4. –ï—Å–ª–∏ –∑–∞–ø—Ä–æ—Å –∏–¥–µ—Ç –Ω–∞ `localhost` - –∑–Ω–∞—á–∏—Ç `VITE_BACKEND_URL` –Ω–µ –ø–æ–¥—Ö–≤–∞—Ç–∏–ª—Å—è, –Ω—É–∂–µ–Ω rebuild frontend

### –ï—Å–ª–∏ CORS –æ—à–∏–±–∫–∏:

- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ, —á—Ç–æ `@fastify/cors` —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω –Ω–∞ backend
- –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –ª–æ–≥–∏ backend –Ω–∞ Render Dashboard

## –ü—Ä–∏–º–µ—á–∞–Ω–∏—è

- **Render.com** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è production –¥–µ–ø–ª–æ—è
- –õ–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞ –±–µ–∑ Telegram WebApp API –Ω–µ–≤–æ–∑–º–æ–∂–Ω–∞ (–º–æ–∂–Ω–æ —Ç–æ–ª—å–∫–æ —á–µ—Ä–µ–∑ –±–æ—Ç–∞)
- Redis –æ–ø—Ü–∏–æ–Ω–∞–ª–µ–Ω –¥–ª—è dev –æ–∫—Ä—É–∂–µ–Ω–∏—è (–Ω–æ—Ä–º–∞–ª—å–Ω–æ –≤–∏–¥–µ—Ç—å ECONNREFUSED –≤ –ª–æ–∫–∞–ª—å–Ω—ã—Ö –ª–æ–≥–∞—Ö)
