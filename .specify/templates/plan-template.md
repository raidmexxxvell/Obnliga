План реализации: [ФУНКЦИЯ]
Ветка: `[###-название-функции]` | Дата: [ДАТА] | Спецификация: [ссылка]
Источник: Спецификация функции из `/specs/[###-название-функции]/spec.md`
Последовательность выполнения (область команды /plan)
1. Загрузить спецификацию функции из указанного пути
   → Если не найдена: ОШИБКА "Нет спецификации функции по пути {путь}"
2. Заполнить Технический контекст (поискать НУЖНО УТОЧНИТЬ)
   → Определить тип проекта по структуре файловой системы или контексту (веб=фронтенд+бэкенд, мобильный=приложение+api)
   → Принять решение о структуре на основе типа проекта
3. Заполнить раздел "Проверка конституции" на основе содержимого конституционного документа.
4. Оценить раздел "Проверка конституции" ниже
   → Если есть нарушения: задокументировать в отслеживании сложности
   → Если нет возможности обосновать: ОШИБКА "Сначала упростите подход"
   → Обновить Отслеживание прогресса: первоначальная проверка конституции
5. Выполнить Фазу 0 → research.md
   → Если остаются НУЖНО УТОЧНИТЬ: ОШИБКА "Разрешите неизвестные моменты"
6. Выполнить Фазу 1 → контракты, data-model.md, quickstart.md, файл шаблона для конкретного агента (например, `CLAUDE.md` для Claude Code, `.github/copilot-instructions.md` для GitHub Copilot, `GEMINI.md` для Gemini CLI, `QWEN.md` для Qwen Code, или `AGENTS.md` для всех остальных агентов).
7. Повторно оценить раздел "Проверка конституции"
   → Если есть новые нарушения: рефакторинг дизайна, возврат к Фазе 1
   → Обновить Отслеживание прогресса: проверка конституции после проектирования
8. Планирование Фазы 2 → Описать подход к генерации задач (НЕ создавать tasks.md)
9. СТОП - Готов к команде /tasks
ВАЖНО: Команда /plan ОСТАНАВЛИВАЕТСЯ на шаге 7. Фазы 2-4 выполняются другими командами:
Фаза 2: команда /tasks создает tasks.md
Фаза 3-4: выполнение реализации (вручную или с помощью инструментов)
Резюме
[Извлечь из спецификации функции: основное требование + технический подход из исследований]
Технический контекст
Язык/Версия : [например, Python 3.11, Swift 5.9, Rust 1.75 или НУЖНО УТОЧНИТЬ] Основные зависимости : [например, FastAPI, UIKit, LLVM или НУЖНО УТОЧНИТЬ] Хранилище : [если применимо, например, PostgreSQL, CoreData, файлы или Н/Д] Целевая платформа : [например, сервер Linux, iOS 15+, WASM или НУЖНО УТОЧНИТЬ]
 Тип проекта : [одиночный/веб/мобильный - определяет структуру источника] Цели производительности : [специфичные для домена, например, 1000 запросов/с, 10к строк/с, 60 кадров/с или НУЖНО УТОЧНИТЬ] Ограничения : [специфичные для домена, например, <200мс p95, <100МБ памяти, оффлайн-работа или НУЖНО УТОЧНИТЬ] Масштаб/Объем : [специфичные для домена, например, 10к пользователей, 1М строк кода, 50 экранов или НУЖНО УТОЧНИТЬ]
Проверка конституции
КОНТРОЛЬНАЯ ТОЧКА: Должна быть пройдена до исследований Фазы 0. Повторная проверка после проектирования Фазы 1.
[Контрольные точки определяются на основе файла конституции]
Структура проекта
Документация (этой функции)
specs/[###-функция]/
├── plan.md              # Этот файл (результат команды /plan)
├── research.md          # Вывод Фазы 0 (команда /plan)
├── data-model.md        # Вывод Фазы 1 (команда /plan)
├── quickstart.md        # Вывод Фазы 1 (команда /plan)
├── contracts/           # Вывод Фазы 1 (команда /plan)
└── tasks.md             # Вывод Фазы 2 (команда /tasks - НЕ создается командой /plan)
Исходный код (корень репозитория)
# [УДАЛИТЬ ЕСЛИ НЕ ИСПОЛЬЗУЕТСЯ] Вариант 1: Одиночный проект (ПО УМОЛЧАНИЮ)
src/
├── models/
├── services/
├── cli/
└── lib/

# [УДАЛИТЬ ЕСЛИ НЕ ИСПОЛЬЗУЕТСЯ] Вариант 2: Веб-приложение (когда обнаружены "фронтенд" + "бэкенд")
backend/
├── src/
│   ├── models/
│   ├── services/
│   └── api/

frontend/
├── src/
│   ├── components/
│   ├── pages/
│   └── services/

# [УДАЛИТЬ ЕСЛИ НЕ ИСПОЛЬЗУЕТСЯ] Вариант 3: Мобильное приложение + API (когда обнаружены "iOS/Android")
api/
└── [такая же структура, как в бэкенде выше]

ios/ или android/
└── [специфичная для платформы структура: модули функций, UI-потоки]
Решение по структуре: [Документирование выбранной структуры и ссылка на реальные каталоги, указанные выше]
##	Фаза 0: Обзор и Исследования
1. **Выявить неизвестные элементы из Технического контекста** выше:
- Для каждого НУЖНО УТОЧНИТЬ → задача исследования
- Для каждой зависимости → задача лучших практик
- Для каждой интеграции → задача шаблонов
2. **Сгенерировать и направить исследовательских агентов**:
Для каждого неизвестного в Техническом контексте:
  Задача: "Исследовать {неизвестное} для {контекста функции}"
Для каждого технологического выбора:
  Задача: "Найти лучшие практики для {технологии} в {домене}"
3. **Собрать результаты** в `research.md` с использованием формата:
-  Решение: [что было выбрано]
-  Обоснование: [почему выбрано]
-  Рассмотренные альтернативы: [что еще оценивалось]
Вывод: research.md со всеми разрешенными НУЖНО УТОЧНИТЬ
## Фаза 1: Проектирование и Контракты
**Предварительные условия: research.md завершен**
1. **Извлечь сущности из спецификации функции** → `data-model.md`:
Имя сущности, поля, отношения
Правила проверки из требований
Переходы состояний при наличии
2. **Сгенерировать API контракты** из функциональных требований:
Для каждого пользовательского действия → конечная точка
Использовать стандартные шаблоны REST/GraphQL
Вывести схему OpenAPI/GraphQL в `/contracts/`
Извлечь сценарии использования из пользовательских историй:
Каждая история → сценарий интеграции
Быстрый старт = шаги проверки историй
3. **Постепенно обновить файл агента** (операция O(1)):
- Запустить `.specify/scripts/powershell/update-agent-context.ps1 -AgentType copilot`ВАЖНО: Выполнить точно как указано выше. Не добавлять и не удалять никаких аргументов.
- Если существует: Добавить ТОЛЬКО НОВЫЕ технологии из текущего плана
- Сохранить ручные дополнения между маркерами
- Обновить последние изменения (сохранить последние 3)
- Сохранить не более 150 строк для эффективности токенов
- Вывод в корень репозитория
Вывод: data-model.md, /contracts/*, quickstart.md, файл для конкретного агента
## Фаза 2: Подход к планированию задач
**Этот раздел описывает, что сделает команда /tasks - НЕ выполняйте во время /plan**
**Стратегия генерации задач**:
- Загрузить `.specify/templates/tasks-template.md` как основу
Сгенерировать задачи из документов проектирования Фазы 1 (контракты, модель данных, quickstart)
Каждый контракт → задача тестирования контракта [P]
Каждая сущность → задача создания модели [P]
Каждая пользовательская история → задача интеграционной проверки
Задачи реализации для прохождения проверок
**Стратегия упорядочивания**:
Порядок: Сначала проверки, затем реализация
Порядок зависимостей: Модели перед сервисами перед UI
Пометить [P] для параллельного выполнения (независимые файлы)
**Предполагаемый вывод**: 25-30 пронумерованных, упорядоченных задач в tasks.md
**ВАЖНО**: Эта фаза выполняется командой /tasks, НЕ командой /plan
## Фазы 3+: Будущая реализация
*Эти фазы за пределами области команды /plan*
**Фаза 3**: Генерация задач (/tasks команда создает tasks.md)
**Фаза 4**: Реализация (выполнение tasks.md в соответствии с конституционными принципами)
**Фаза 5**: Проверка (выполнение quickstart.md, валидация производительности)

## Отслеживание сложности
Заполнять ТОЛЬКО если в разделе "Проверка конституции" есть нарушения, которые необходимо обосновать
| Нарушение
|Почему необходимо
|Отклоненная более простая альтернатива
|
| ---|---|---|
| [напр., 4-й проект]
|[текущая потребность]
|[почему 3 проектов недостаточно]
|
| [напр., Паттерн Repository]
|[конкретная проблема]
|[почему прямой доступ к БД недостаточен]
|
Отслеживание прогресса
Этот контрольный список обновляется во время последовательности выполнения
Статус фаз:
[ ] Фаза 0: Исследования завершены (команда /plan)
[ ] Фаза 1: Проектирование завершено (команда /plan)
[ ] Фаза 2: Планирование задач завершено (команда /plan - только описание подхода)
[ ] Фаза 3: Задачи сгенерированы (команда /tasks)
[ ] Фаза 4: Реализация завершена
[ ] Фаза 5: Проверка пройдена
Статус контрольных точек:
[ ] Первоначальная проверка конституции: ПРОЙДЕНО
[ ] Проверка конституции после проектирования: ПРОЙДЕНО
[ ] Все НУЖНО УТОЧНИТЬ разрешены
[ ] Отклонения от сложности задокументированы
На основе Конституции v2.1.1 - См. `/memory/constitution.md`